{% extends 'base.html.twig' %}

{% block title %}Content{% endblock %}

{% block body %}
    <h1>Content</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ content.id }}</td>
            </tr>
            <tr>
                <th>Title</th>
                <td>{{ content.title }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ content.description }}</td>
            </tr>
            <tr>
                <th>File</th>
                <td>{{ content.file }}</td>
            </tr>
            <tr>
                <th>Statut</th>
                <td>{{ content.statut }}</td>
            </tr>
            <tr>
                <th>SubmitUser</th>
                <td>{{ content.userSubmit.firstname ? content.userSubmit.firstname : '' }}</td>
            </tr>
            <tr>
                <th>SubmitDate</th>
                <td>{{ content.submitDate ? content.submitDate|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>ApprovalDate</th>
                <td>{{ content.approvalDate ? content.approvalDate|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>PublicationDate</th>
                <td>{{ content.publicationDate ? content.publicationDate|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
        </tbody>
    </table>

    <h5>Add a comment</h5>

    {{ include('comment/_form.html.twig') }}

    <h5>Comments</h5>
    <table>
        <tbody>

        {% if comments %}
            {% for comment in comments %}
                <tr>
                    <th>Message</th>
                    <td>{{ comment.message }}</td>
                    <td></td>
                    <td>
                        <a href="{{ path('comment_edit', {'id': comment.id}) }}" style="color: dodgerblue">edit comm</a>
                        <a href="{{ path('comment_delete', {'id': comment.id}) }}"  style="color: red">delete comm</a>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <p>No comments</p>
        {% endif %}
        </tbody>
    </table>
    <br><br>

    <a href="{{ path('content_index') }}">back to list</a>

    <a href="{{ path('content_edit', {'id': content.id}) }}">edit</a>

    <h3>Review</h3>
    <button class="btn btn-success review" value="1">Approved</button>
    <button class="btn btn-danger review" value="2">Rejected</button>

    {% if content.statut == 1 %}
        <button class="btn btn-success" id="publish" name="publish">Publier</button>
    {% endif %}

    {{ include('content/_delete_form.html.twig') }}
{% endblock %}

{% block javascripts %}
    <script language = "javascript"
            src = "https://code.jquery.com/jquery-2.2.4.min.js">
    </script>
    <script>
        $(function(){
            $("#publish").click(function() {
                $.ajax({
                    url: '{{ path('publish') }}',
                    type: 'GET',
                    data: {contentId: {{content.id}}},

                    success: function(data) {
                        alert("contenu publi√©");
                        location.reload(true);
                    },
                    error : function(xhr, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
            });
        });


        $(function(){
            $(".review").click(function() {
                var contentStatus = $(this).val();
                $.ajax({
                    url: '{{ path('approval_new') }}',
                    type: 'POST',
                    data: {content_id: {{content.id}}, status: contentStatus },

                    success: function(data, status) {
                        alert(data)
                    },
                    error : function(xhr, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
            });
        });
    </script>
{% endblock %}
